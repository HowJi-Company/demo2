import{d as z,s as x,l as H,r as c,o as $,m as h,b as l,c as i,e,n as I,q as d,f as S,y as W,u as j,h as G,z as s,p as q,j as K,_ as Y}from"./index-C5k5Gm4v.js";import{u as J}from"./message-CKVmI11u.js";import{g as Q,d as X,u as Z,i as ee,s as te,a as se,c as oe}from"./index.esm2017-CVWjl4HZ.js";const ae="/images/button_%E5%82%B3%E9%80%81%E7%B5%A6%E5%A5%BD%E5%8F%8B.png",re="/images/button_%E5%86%8D%E7%8E%A9%E4%B8%80%E6%AC%A1.png";var a={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const v=n=>(q("data-v-40d50b9f"),n=n(),K(),n),ne={class:"bg_img container relative min-h-screen bg-standard"},ce={class:"relative flex h-screen flex-col items-center"},le={class:"flex flex-col items-center"},ie={class:"h-[350px] w-[350px]"},ue=["src"],de={key:0,class:"my-3 text-center text-xs font-medium tracking-[1.2px] text-white",style:{"font-family":"'GenSenRounded'"}},pe=v(()=>e("img",{src:ae,alt:"傳送給好友",class:"w-full"},null,-1)),_e=[pe],me=v(()=>e("img",{src:re,alt:"再玩一次",class:"w-full"},null,-1)),fe=[me],ge=z({__name:"ResultView",setup(n){const w=a.VITE_FIRESTORE_SHARE_COUNTS_COLLECTION,b=a.VITE_FIRESTORE_SHARE_BTN_DOC,T=a.VITE_FIRESTORE_SENDERS_COLLECTION,p=Q(W),{displayName:_,uuid:R,selectedProductNum:k,cardImgFileName:u}=x(H()),{cardBase64Url:m}=x(J()),C=j(),f=G(),A=c(""),L=c(25),O=c(75),N=()=>{C.push({name:"start"})};$(()=>{f.name&&(A.value=f.name)});const g=h(()=>`${a.VITE_AWS_BASE_URL}/${u.value}`),D=async()=>{const t=X(p,w,b);await Z(t,{clicks:ee(1)}).catch(async r=>{console.error("Error updating click count: ",r),await te(t,{clicks:1})})},V=async()=>{try{await se(oe(p,T),{uuid:R.value,displayName:_.value,selectedProductNumber:k.value})}catch(t){console.error("Error adding document: ",t)}},B=c(!1),F=async()=>{const t=a.VITE_LINE_MAKE_CARD_URL,r=a.VITE_ACTIVITY_SITE_URL,E=a.VITE_LIFF_ID;if(!E){console.warn("LIFF ID is not configured");return}try{if(!s.isLoggedIn()){await s.init({liffId:E}),s.login({redirectUri:window.location.origin});return}}catch(o){console.error("LIFF init/login error:",o);return}if(!s.isApiAvailable("shareTargetPicker")){console.error("Share Target Picker API is not available");return}try{const o=await s.shareTargetPicker([{type:"text",text:`${_.value}為你送來祝福囉！`},{type:"flex",altText:"快來看看！是誰送上了祝福給你？",contents:{type:"bubble",hero:{type:"image",url:g.value,size:"full",aspectRatio:"1:1",aspectMode:"cover"},body:{type:"box",layout:"vertical",contents:[{type:"text",wrap:!0,text:"花開富貴 新年祝福",weight:"bold",size:"xl"},{type:"text",wrap:!0,text:"快來製作你的專屬賀卡！",weight:"regular",size:"md"}]},footer:{type:"box",layout:"vertical",spacing:"sm",contents:[{type:"button",style:"link",height:"sm",action:{type:"uri",label:"製作專屬客製化新年賀卡",uri:t}},...r?[{type:"button",style:"link",height:"sm",action:{type:"uri",label:"查看活動詳情",uri:r}}]:[],{type:"box",layout:"vertical",contents:[],margin:"sm"}],flex:0}}}]);if(o&&o.status==="success")console.log("firebase gogo"),console.log(o),B.value=!0,await D(),await V();else{const[P,M]=(s.getLineVersion()||"").split(".");parseInt(P)==10&&parseInt(M)<11?console.log("TargetPicker was opened at least. Whether succeeded to send message is unclear"):console.log("TargetPicker was closed!")}}catch(o){console.error(o),console.error("Flex Message got some error"),s.closeWindow()}},U=async()=>{u.value&&s.openWindow({url:g.value,external:!0})},y=h(()=>localStorage.getItem("userOS")==="ios");return(t,r)=>(l(),i("main",ne,[e("div",ce,[e("div",{class:"absolute left-1/2 w-full -translate-x-1/2",style:I({top:`${L.value}%`})},[e("div",le,[e("div",ie,[d(m)?(l(),i("img",{key:0,src:d(m),alt:"card",class:"h-full w-full object-cover"},null,8,ue)):S("",!0)]),y.value?(l(),i("p",de," 長按圖片可下載 ")):!y.value&&d(u)?(l(),i("p",{key:1,style:{"font-family":"'GenSenRounded'"},onClick:U,class:"my-3 cursor-pointer text-center text-xs font-medium tracking-[1.2px] text-white"}," 點我下載圖片 ")):S("",!0)])],4),e("div",{class:"absolute left-1/2 w-full -translate-x-1/2",style:I({top:`${O.value}%`})},[e("div",{class:"flex flex-col items-center gap-[9px]"},[e("button",{type:"button",class:"w-[235px]",onClick:F},_e),e("button",{type:"button",class:"w-[235px]",onClick:N},fe)])],4)])]))}}),he=Y(ge,[["__scopeId","data-v-40d50b9f"]]);export{he as default};
