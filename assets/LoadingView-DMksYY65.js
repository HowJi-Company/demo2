import{d as Y,c as I,u as G,s as K,r as x,o as Q,a as H,b as v,e as X,w as Z,f as c,g as ee,h as te,i as l,n as V,j as g,k as h,l as ae,m as oe,t as se,F as ne}from"./index-DxiDE33M.js";import{_ as re,l as T,w as B,c as ie,m as le,a as ce,b as ue,d as de,e as me,f as ge}from"./遊戲開始前動畫-BCEbnUK-.js";import{w as C}from"./warning_footer-D9FTkEpB.js";import{t as pe,l as fe,a as ve}from"./transition1_text-8_mbph0K.js";import{b as E,s as we,t as ye,a as _e}from"./過場煙霧-CCM1rfwx.js";import{t as xe}from"./結果頁前動畫-CN-4tEZb.js";import{q as he}from"./question_background1-CIrWtZw_.js";import{q as Te,a as qe,b as be,c as ke,d as Pe,e as Le,f as Se,g as Ie,h as Ve,i as Be,j as Ce,k as Ee,l as Re,m as $e,n as De}from"./q3_4-LDCSfSum.js";import{r as Ne,a as je,b as ze,c as Fe,d as Ue,e as Ae,f as We}from"./result2-BqxVhMQC.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me="/assets/window1-BACkLmSu.png",Oe="/assets/loading-D1AS_sxJ.mp4",Ye="/assets/q1_text-Bis6gJNr.png",Ge="/assets/q2_text-q_QYaptv.png",Ke="/assets/q3_text-zgaKPNSA.png",Qe="/assets/q4_text-CgCdBmPP.png",He={class:"relative flex items-center justify-center"},Xe={class:"relative block"},Ze=["src"],et=["src"],tt=["src"],at=["src"],ot=Y({__name:"LoadingView",setup(st){const R=ee(),q=te(),n=I(()=>{const e=q.query.video||q.query.useVideo;if(!e)return!0;const t=String(e).toLowerCase();return!(t==="false"||t==="0"||t==="no")}),b=T,$=I(()=>({backgroundImage:`url(${b})`,backgroundSize:"cover",backgroundPosition:"center"})),k=[T,B,C,ie,le,ce,ue,de,me,he,Ye,Te,qe,be,ke],D=[pe,E,fe,ve,E,we,ye,Pe,Le,Se,Ge,Ke,Qe,Ie,Ve,Be,Ce,Ee,Re,$e,De,Ne,je,ze,Fe,Ue,Ae,We],P=[ge,_e],N=[xe],j=G();K(j);const u=x(!1),d=x(null),z=x(40),F="Loading......".split("");let i=null,p=null,w=null,L=!1;const y=e=>new Promise((t,a)=>{const o=new Image;o.onload=()=>t(),o.onerror=()=>t(),o.src=e}),S=e=>new Promise(t=>{const a=document.createElement("video");a.preload="auto",a.src=e,a.load(),a.addEventListener("canplay",()=>t(),{once:!0}),a.addEventListener("error",()=>t(),{once:!0}),setTimeout(()=>t(),5e3)}),U=async()=>{try{await Promise.all(k.map(y)),console.log("關鍵圖片預載入完成")}catch(e){console.warn("關鍵圖片預載入失敗，繼續執行",e)}try{await Promise.all(P.map(S)),console.log("關鍵影片預載入完成")}catch(e){console.warn("關鍵影片預載入失敗，繼續執行",e)}if(Promise.all(D.map(y)).then(()=>{console.log("次要圖片預載入完成")}),Promise.all(N.map(S)).then(()=>{console.log("次要影片預載入完成")}),n.value&&d.value)try{await new Promise((e,t)=>{const a=d.value,o=setTimeout(()=>{t(new Error("影片載入超時"))},1e4);a.readyState>=3?(clearTimeout(o),e()):(a.addEventListener("canplay",()=>{clearTimeout(o),e()},{once:!0}),a.addEventListener("error",_=>{clearTimeout(o),t(_)},{once:!0}))})}catch(e){console.warn("Loading 影片載入失敗，繼續執行",e)}},A=()=>(w||(w=U()),w),W=async()=>{let e=0,t=0;const a=k.map(m=>(t++,new Promise(r=>{const s=new Image;s.onload=()=>{e++,r()},s.onerror=()=>{e++,r()},s.src=m,s.complete&&(e++,r())}))),o=P.map(m=>(t++,new Promise(r=>{const s=document.createElement("video");s.preload="auto",s.src=m,s.load();const O=()=>{s.readyState>=2&&(e++,r())};s.addEventListener("canplay",()=>{e++,r()},{once:!0}),s.addEventListener("error",()=>{e++,r()},{once:!0}),O(),setTimeout(()=>{s.readyState>=1,e++,r()},200)})));await Promise.race([Promise.all([...a,...o]),new Promise(m=>setTimeout(m,300))]);const _=t>0?Math.round(e/t*100):100,M=e>=t;return{loaded:e,total:t,percentage:_,isComplete:M}},f=async()=>{if(L)return;L=!0;const e=await W();e.isComplete?console.log("✅ Loading 完成！所有資源已載入"):console.log(`⏳ Loading 進行中：${e.loaded}/${e.total} (${e.percentage}%)`);try{await y(T),await new Promise(t=>setTimeout(t,50))}catch(t){console.warn("背景圖片預載入失敗，繼續執行",t)}try{R.push({name:"cover"})}catch(t){console.error("跳轉失敗",t)}},J=()=>{i&&(clearTimeout(i),i=null),f()};return Q(async()=>{if(A(),n.value){if(d.value&&d.value.ended){f();return}i=setTimeout(()=>{f()},5500);return}p=setTimeout(()=>{u.value=!0},500),i=setTimeout(()=>{f()},5500)}),H(()=>{i&&(clearTimeout(i),i=null),p&&(clearTimeout(p),p=null)}),(e,t)=>(v(),X(re,{src:c(b),darken:.2,edgeRatio:.01,containerClass:"min-h-screen w-full overflow-hidden font-sans",as:"main"},{default:Z(()=>[l("div",{class:"relative mx-auto flex min-h-[100vh] w-full max-w-[480px] flex-col items-center justify-center px-4 text-center",style:g($.value)},[l("div",He,[l("div",Xe,[l("img",{src:c(Me),alt:"window1",class:V(["block transition-opacity duration-[4000ms]",{"opacity-0":u.value||n.value,"opacity-100":!u.value&&!n.value}]),style:g({maxWidth:"75%",margin:"0 auto",visibility:n.value?"hidden":"visible"})},null,14,Ze),l("img",{src:c(B),alt:"window2",class:V(["absolute left-1/2 top-0 block -translate-x-1/2 transition-opacity duration-[4000ms]",{"opacity-100":u.value&&!n.value,"opacity-0":!u.value||n.value}]),style:g({maxWidth:"75%",margin:"0 auto",visibility:n.value?"hidden":"visible"})},null,14,et),n.value?(v(),h("video",{key:0,ref_key:"videoRef",ref:d,src:c(Oe),class:"absolute left-1/2 top-1/2 block w-full -translate-x-1/2 -translate-y-1/2",style:{"margin-top":"-20px"},autoplay:"",muted:"",playsinline:"",onEnded:J},null,40,tt)):ae("",!0),l("div",{class:"absolute left-1/2 flex -translate-x-1/2 items-center justify-center gap-0.5 text-white",style:g({top:`calc(100% + ${z.value}px)`})},[(v(!0),h(ne,null,oe(c(F),(a,o)=>(v(),h("span",{key:o,class:"bounce-char inline-block font-bold",style:g({animationDelay:`${o*.1}s`})},se(a),5))),128))],4)])]),l("img",{src:c(C),alt:"警告標語",class:"absolute bottom-0 left-0 z-10 w-full"},null,8,at)],4)]),_:1},8,["src"]))}}),ft=Je(ot,[["__scopeId","data-v-0eb4ef7f"]]);export{ft as default};
