import{g as B,d as V,b as q,e as x,c as U}from"./index.esm2017-CVWjl4HZ.js";import{d as j,B as G,r as M,D as K,b as O,c as v,e as a,t as w,F as $,g as z,u as P,y as W,E as Q}from"./index-C5k5Gm4v.js";var X={fieldSeparator:",",decimalSeparator:".",quoteStrings:!0,quoteCharacter:'"',showTitle:!1,title:"My Generated Report",filename:"generated",showColumnHeaders:!0,useTextFile:!1,useBom:!0,columnHeaders:[],useKeysAsHeaders:!1,boolDisplay:{true:"TRUE",false:"FALSE"},replaceUndefinedWith:""},Y=`\r
`,Z="\uFEFF",y=e=>Object.assign({},X,e);class J extends Error{constructor(t){super(t),this.name="CsvGenerationError"}}class A extends Error{constructor(t){super(t),this.name="EmptyHeadersError"}}class ee extends Error{constructor(t){super(t),this.name="CsvDownloadEnvironmentError"}}var h=e=>e,c=e=>e,_=h,p=h,R=h,T=h,te=function(e,t){return t=='"'&&e.indexOf('"')>-1?e.replace(/"/g,'""'):e},oe=e=>R(typeof e=="object"?e.key:e),se=e=>T(typeof e=="object"?e.displayLabel:e),re=(e,...t)=>t.reduce((o,s)=>s(o),e),ae=e=>t=>e.useBom?_(c(t)+Z):t,ne=e=>t=>e.showTitle?S(_(c(t)+e.title))(p("")):t,S=e=>t=>_(c(e)+c(t)+Y),N=e=>(t,o)=>ce(e)(p(t+o)),ce=e=>t=>h(c(t)+e.fieldSeparator),ie=(e,t)=>o=>{if(!e.showColumnHeaders)return o;if(t.length<1)throw new A("Option to show headers but none supplied. Make sure there are keys in your collection or that you've supplied headers through the config options.");let s=p("");for(let r=0;r<t.length;r++){const i=se(t[r]);s=N(e)(s,D(e,i))}return s=p(c(s).slice(0,-1)),S(o)(s)},le=(e,t,o)=>s=>{let r=s;for(var i=0;i<o.length;i++){let l=p("");for(let n=0;n<t.length;n++){const m=oe(t[n]),E=typeof o[i][c(m)]>"u"?e.replaceUndefinedWith:o[i][c(m)];l=N(e)(l,D(e,E))}l=p(c(l).slice(0,-1)),r=S(r)(l)}return r},L=e=>+e===e&&(!isFinite(e)||!!(e%1)),D=(e,t)=>{if(e.decimalSeparator==="locale"&&L(t))return t.toLocaleString();if(e.decimalSeparator!=="."&&L(t))return t.toString().replace(".",e.decimalSeparator);if(typeof t=="string"){let o=t;return(e.quoteStrings||e.fieldSeparator&&t.indexOf(e.fieldSeparator)>-1||e.quoteCharacter&&t.indexOf(e.quoteCharacter)>-1||t.indexOf(`
`)>-1||t.indexOf("\r")>-1)&&(o=e.quoteCharacter+te(t,e.quoteCharacter)+e.quoteCharacter),o}if(typeof t=="boolean"&&e.boolDisplay){const o=t?"true":"false";return e.boolDisplay[o]}return t},ue=e=>t=>{const o=y(e),s=o.useKeysAsHeaders?Object.keys(t[0]):o.columnHeaders;let r=re(_(""),ae(o),ne(o),ie(o,s),le(o,s,t));if(c(r).length<1)throw new J("Output is empty. Is your data formatted correctly?");return r},de=e=>t=>{if(!window)throw new ee("Downloading only supported in a browser environment.");const o=y(e),s=c(t),r=o.useTextFile?"plain":"csv",i=o.useTextFile?"txt":"csv";let l=new Blob([s],{type:`text/${r};charset=utf8;`}),n=document.createElement("a");n.download=`${o.filename}.${i}`,n.href=URL.createObjectURL(l),n.setAttribute("visibility","hidden"),document.body.appendChild(n),n.click(),document.body.removeChild(n)},g={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const pe={class:"container min-h-screen bg-standard pb-12 pt-[20px]"},me={class:"flex flex-col items-center"},he={class:"mb-20 mt-10 text-xl"},fe=a("p",{class:"mb-16 text-2xl font-medium"},"參加者資訊",-1),ge=a("p",{class:"mb-16 text-center text-2xl font-medium"},"賀卡編號",-1),_e={class:"grid gap-4 lg:grid-cols-6"},Ee=["src"],be={class:"mt-4 block text-center text-xl font-medium"},Ce=j({__name:"DownLoadView",setup(e){const t=P(),o=G(),s=B(W),r=g.VITE_FIRESTORE_SHARE_COUNTS_COLLECTION,i=g.VITE_FIRESTORE_SHARE_BTN_DOC,l=g.VITE_FIRESTORE_SENDERS_COLLECTION,n=g.VITE_CSV_FILENAME,m=M(0),E=async()=>{const u=V(s,r,i),f=await q(u);f.exists()?m.value=f.data().clicks:console.log("No such document!")};K(()=>{E()});const C=y({useKeysAsHeaders:!0,filename:n}),I=async()=>{let u=[];(await x(U(s,l))).forEach(d=>{let k={uuid:d.data().uuid,displayName:d.data().displayName,productNum:d.data().selectedProductNumber};u.push(k)});const b=ue(C)(u);de(C)(b)},F=()=>{Q(o).then(()=>{t.push({name:"admin"})}).catch(u=>{console.log("登出失敗",u)})},H=["/images/card01.png","/images/card02.png","/images/card03.png","/images/card04.png","/images/card05.png","/images/card06.png"];return(u,f)=>(O(),v("main",pe,[a("div",me,[a("h2",he,"目前總分享次數："+w(m.value),1),a("div",{class:"mb-20 flex flex-col justify-center"},[fe,a("button",{type:"button",class:"rounded bg-blue-950 px-4 py-2 text-white hover:bg-blue-800",onClick:I}," 下載CSV ")]),a("div",null,[ge,a("ul",_e,[(O(),v($,null,z(H,(b,d)=>a("li",{key:d},[a("img",{class:"w-full",src:b,alt:"product"},null,8,Ee),a("span",be,w(d+1),1)])),64))])]),a("div",{class:"absolute right-12 top-12"},[a("button",{type:"button",class:"rounded bg-zinc-800 px-3 py-2 text-sm text-white hover:bg-zinc-600",onClick:F}," 登出 ")])])]))}});export{Ce as default};
