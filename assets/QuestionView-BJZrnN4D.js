import{d as se,r as i,c as f,o as oe,z as w,b as v,k as p,i as r,j as m,l as h,n as d,t as $,F as M,m as U,f as ie,g as le,p as ue}from"./index-DK4RB-FT.js";import{q as re}from"./question_background1-CIrWtZw_.js";import{d as ce,e as me,f as ve,q as pe,a as fe,b as we,c as de,g as ge,h as ye,i as xe,j as qe,k as _e,l as Te,m as Pe,n as he}from"./q3_4-LDCSfSum.js";import{M as be}from"./MetallicButton-DOQaeiG9.js";import{w as ke}from"./warning_footer-D9FTkEpB.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"relative min-h-screen w-full font-sans"},Oe=["onClick"],Ae=["src","alt"],Ce=["src"],De=800,Ee=0,Qe=700,Re=500,Be=500,ze=60,G="wineQuizAnswers",Fe=se({__name:"QuestionView",setup(Ne){const V=le(),b=i(!1),k=new Map;function Q(e){var s;if(k.has(e))return k.get(e);const a=new Image;a.decoding="async",a.loading="eager",a.src=e;const t=(((s=a.decode)==null?void 0:s.call(a))??Promise.resolve()).catch(()=>{});return k.set(e,t),t}const T=[re,ce,me,ve],j=[`在這個微醺的夜裡
找到屬於自己的角落 —
此刻的你，想待在哪裡？`,`當你入座後，
四周人聲笑語交織，
你的目光停留在？`,`如果只能用一件物品，
換取一杯酒，
你最捨不得放下的是哪一樣？`,`微醺夜裡，
你會選擇怎麼與這份醉意共度？`],o=i(0),J=f(()=>j[o.value]),S=[[pe,fe,we,de],[ge,ye,xe,qe],[_e,Te,Pe,he],[]],I=["跟朋友聊聊心裡話","靜靜沉澱，與自己對話","高歌或跳舞，釋放壓力","觀察周圍，感受當下氛圍"],O=f(()=>o.value<3?S[o.value]:[]),g=i(null),y=i(0),A=i(null),C=i(!1),x=i(!1),L=i(null),n=i("pre-in"),D=i(!0),q=i(!1),E=i(!1),u=i("pre-enter"),_=i(!0),X=f(()=>({"q-pre-enter":u.value==="pre-enter","q-enter-anim":u.value==="enter","q-to-top":u.value==="toTop","q-exit":u.value==="exit","q-no-transition":_.value}));async function R(){n.value="pre-in",_.value=!0,u.value="pre-enter",await w(),await new Promise(t=>requestAnimationFrame(t)),_.value=!1,await w(),await new Promise(t=>requestAnimationFrame(t)),u.value="enter",await new Promise(t=>setTimeout(t,De+16)),u.value="hold",await new Promise(t=>setTimeout(t,Ee)),u.value="toTop",await new Promise(t=>setTimeout(t,Qe+16)),await new Promise(t=>setTimeout(t,Re)),n.value="in";const a=((o.value<3?O.value.length:I.length)-1)*ze;await new Promise(t=>setTimeout(t,Be+a+16)),n.value="idle"}const B=i(!1),H=f(()=>b.value?{opacity:1,filter:"blur(0px)",transition:"opacity 2s ease-out, filter 2s ease-out",zIndex:0}:{opacity:0,filter:"blur(12px)",transition:"opacity 2s ease-out, filter 2s ease-out",zIndex:0}),K=f(()=>b.value?{opacity:1,filter:"blur(0px)",transition:"opacity 2s ease-out, filter 2s ease-out"}:{opacity:0,filter:"blur(10px)",transition:"opacity 2s ease-out, filter 2s ease-out"}),Y=f(()=>{let e=0;return E.value?e=1:q.value&&(e=.5),{backgroundColor:"#000",opacity:e,pointerEvents:q.value||E.value?"auto":"none",transition:"opacity 300ms ease-in-out"}}),W=i({top:140,left:50,leftOffset:0}),Z=f(()=>{const{top:e,left:a,leftOffset:t}=W.value;return{top:`${e}px`,left:`${a}%`,transform:`translateX(calc(-50% + ${t}px))`}}),z=i(196),ee=()=>{const a=[...T,...S.flat()].map(t=>new Promise(s=>{const c=new Image;c.onload=()=>s(),c.onerror=()=>s(),c.src=t}));Promise.all(a).then(()=>{B.value=!0})};oe(async()=>{ee(),b.value=!0,await w(),await new Promise(e=>requestAnimationFrame(e)),await new Promise(e=>setTimeout(e,2e3)),await R()});const te=()=>{try{const e=localStorage.getItem(G);return e?JSON.parse(e):[]}catch(e){return console.error("讀取 localStorage 失敗:",e),[]}},ae=(e,a)=>{try{const t=te(),s=t.findIndex(c=>c.question===e);s>=0?t[s].answer=a:t.push({question:e,answer:a}),localStorage.setItem(G,JSON.stringify(t)),console.log("已保存答案:",t)}catch(t){console.error("保存答案到 localStorage 失敗:",t)}},ne=async()=>{x.value=!0,u.value="exit",n.value="out",await new Promise(e=>setTimeout(e,600)),q.value=!0,await new Promise(e=>setTimeout(e,700)),E.value=!0,await new Promise(e=>setTimeout(e,400)),V.push({name:"transition3"})},F=async e=>{x.value||n.value!=="idle"||(ae(o.value,e),o.value<2?(await new Promise(a=>setTimeout(a,300)),await N()):o.value===2?(await new Promise(a=>setTimeout(a,300)),await N()):(await new Promise(a=>setTimeout(a,300)),await ne()))},N=async()=>{if(!(x.value||o.value>=4||!B.value))try{x.value=!0;const e=o.value+1,a=[...(e<3?S[e]:[]).map(Q),Q(T[e])];await Promise.allSettled(a),requestAnimationFrame(()=>{(o.value<3||o.value===3)&&(n.value="out"),u.value="exit",q.value=!0});const t=500,s=60,c=600;let P=0;o.value<3?(P=(O.value.length-1)*s,await new Promise(l=>setTimeout(l,Math.max(t+P,c)+16)),D.value=!1):o.value===3?(P=(I.length-1)*s,await new Promise(l=>setTimeout(l,Math.max(t+P,c)+16))):await new Promise(l=>setTimeout(l,c+16)),_.value=!0,u.value="pre-enter",n.value="pre-in",await w(),await new Promise(l=>requestAnimationFrame(l)),_.value=!1,o.value=e,await w(),g.value=e,y.value=0,await w(),await new Promise(l=>requestAnimationFrame(l)),y.value=1,await new Promise(l=>setTimeout(l,1e3)),g.value=null,y.value=0,q.value=!1,await new Promise(l=>setTimeout(l,600)),e<3&&(D.value=!0),await w(),await R()}catch(e){console.error(e),A.value=null,g.value=null,y.value=0,C.value=!1,n.value="idle"}finally{x.value=!1}};return(e,a)=>(v(),p("main",Ie,[r("div",{class:"background-container",style:m(H.value)},[r("div",{class:"background-layer current-layer",style:m({backgroundImage:`url(${T[o.value]})`,backgroundSize:"cover",backgroundPosition:"center",opacity:1})},null,4),g.value!==null?(v(),p("div",{key:0,class:"background-layer next-layer",style:m({backgroundImage:`url(${T[g.value]})`,backgroundSize:"cover",backgroundPosition:"center",opacity:y.value})},null,4)):h("",!0)],4),r("div",{class:"relative z-10 mx-auto flex min-h-[100vh] w-full max-w-[480px] flex-col items-center justify-start px-0 pt-8 text-center",style:m(K.value)},[r("div",{class:"question-image-container",style:m(Z.value)},[r("div",{class:d(["question-seq",X.value])},[r("div",{class:d(["question-text current-question",{"fading-out":C.value}])},$(J.value),3),A.value?(v(),p("div",{key:0,class:d(["question-text next-question",{"fading-in":C.value}]),ref_key:"nextTextRef",ref:L},$(A.value),3)):h("",!0)],2)],4),o.value<3&&D.value?(v(),p("div",{key:0,class:"button-area relative w-full max-w-md px-[30px]",style:m({marginTop:`${z.value}px`})},[r("div",{class:d(["options-layer grid grid-cols-2 gap-4",{animating:n.value!=="idle"}])},[(v(!0),p(M,null,U(O.value,(t,s)=>(v(),p("button",{key:"opt-"+o.value+"-"+s,type:"button",class:"option-cell",onClick:c=>F(s)},[r("img",{src:t,alt:`選項${s+1}`,class:d(["option-img",{"opt-out":n.value==="out","opt-pre-in":n.value==="pre-in"||n.value==="in","opt-in-anim":n.value==="in"}]),style:m({animationDelay:n.value==="out"||n.value==="in"?s*60+"ms":"0ms"}),decoding:"async",loading:"eager",draggable:"false"},null,14,Ae)],8,Oe))),128))],2)],4)):h("",!0),o.value===3?(v(),p("div",{key:1,class:"button-area-vertical relative w-full max-w-md px-0",style:m({marginTop:`${z.value}px`})},[r("div",{class:d(["q4-buttons-layer flex flex-col items-center gap-4",{animating:n.value!=="idle"}])},[(v(),p(M,null,U(I,(t,s)=>ue(be,{key:"q4-opt-"+s,"text-shadow":!0,text:t,width:"320px",height:"50px",showStars:!0,glow:!0,onClick:()=>F(s),class:d(["q4-button w-full max-w-sm",{"q4-opt-out":n.value==="out","q4-opt-pre-in":n.value==="pre-in"||n.value==="in","q4-opt-in-anim":n.value==="in"}]),style:m({animationDelay:n.value==="out"||n.value==="in"?s*60+"ms":"0ms"})},null,8,["text","onClick","class","style"])),64))],2)],4)):h("",!0),r("img",{src:ie(ke),alt:"警告標語",class:"absolute bottom-0 left-0 z-10 w-full"},null,8,Ce)],4),r("div",{class:"fade-overlay",style:m(Y.value)},null,4)]))}}),Je=Se(Fe,[["__scopeId","data-v-b3bda2bf"]]);export{Je as default};
